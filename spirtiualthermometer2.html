<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lesson 141: Spiritual Thermometer</title>
    <style>
        :root {
            --primary-blue: #246BB2;
            --liquid-red: #cc0000;
            --glass-grey: #e0e0e0;
            --text-dark: #333;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f9;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        h1 {
            color: var(--text-dark);
            margin-bottom: 20px;
            text-align: center;
            font-size: 1.8rem;
        }

        .container {
            display: flex;
            flex-direction: row; /* Default: Side by Side */
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-width: 1000px;
            width: 100%;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
        }

        /* --- Thermometer Styles --- */
        .thermometer-wrapper {
            position: relative;
            width: 240px; /* Wider container */
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-right: 40px;
        }

        .thermo-3d {
            width: 200px;
            height: 560px;
            position: relative;
            z-index: 1;
        }

        .thermo-3d canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .thermo-2d {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        body.is-3d .thermo-2d {
            display: none;
        }

        body.is-3d .thermo-3d {
            filter: drop-shadow(0 14px 20px rgba(0, 0, 0, 0.25));
        }

        .thermometer-glass {
            width: 70px; /* Much wider tube */
            height: 500px; /* Taller */
            background: var(--glass-grey);
            border-radius: 50px 50px 0 0;
            border: 6px solid #555;
            position: relative;
            z-index: 2;
            overflow: hidden; /* Keeps liquid inside */
        }

        .thermometer-bulb {
            width: 130px; /* Big bulb */
            height: 130px;
            background: var(--liquid-red);
            border-radius: 50%;
            border: 6px solid #555;
            margin-top: -20px;
            z-index: 1;
            box-shadow: inset -10px -10px 20px rgba(0,0,0,0.3);
        }

        .mercury {
            width: 100%;
            background: var(--liquid-red);
            position: absolute;
            bottom: 0;
            left: 0;
            height: 5%; 
            transition: height 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- High Visibility Ticks --- */
        .ticks {
            position: absolute;
            height: 480px; /* Match internal height roughly */
            top: 10px;
            left: 150px; /* Push to right of tube */
            display: flex;
            flex-direction: column-reverse;
            justify-content: space-around;
            z-index: 3;
        }

        .tick-mark {
            display: flex;
            align-items: center;
            font-weight: 800;
            color: #222; /* Darker text */
            font-size: 1.5rem; /* Bigger numbers */
        }
        
        .tick-line {
            width: 30px; /* Longer lines */
            height: 5px; /* Thicker lines */
            background: #222; /* Dark black lines */
            margin-right: 15px;
        }

        /* --- Interactive Questions List --- */
        .questions-list {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            max-width: 500px;
        }

        .question-item {
            padding: 15px 20px;
            border: 3px solid #ddd; /* Thicker border */
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            background: #fff;
            font-size: 1.1rem;
        }

        .question-item:active {
            transform: scale(0.98);
        }

        .question-item:hover {
            border-color: #bbb;
            background-color: #fafafa;
        }

        /* Active State (Selected) */
        .question-item.active {
            background-color: #e6f7ff;
            border-color: var(--primary-blue);
            color: var(--primary-blue);
            font-weight: bold;
            box-shadow: 0 4px 12px rgba(36, 107, 178, 0.2);
        }

        .number-badge {
            background: #666;
            color: white;
            min-width: 35px;
            height: 35px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 15px;
            font-size: 1rem;
            font-weight: bold;
        }

        .question-item.active .number-badge {
            background: var(--primary-blue);
        }

        .reset-btn {
            margin-top: 20px;
            padding: 12px 25px;
            background-color: #4A4A4A;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            width: 100%;
            max-width: 200px;
            align-self: center;
        }

        /* --- MOBILE ADAPTIVE (Responsive) --- */
        @media (max-width: 768px) {
            h1 { font-size: 1.4rem; }
            
            .container {
                flex-direction: column; /* Stack vertically */
                padding: 20px;
            }

            .thermometer-wrapper {
                margin-right: 0;
                margin-bottom: 30px;
                transform: scale(0.9); /* Slight shrink to fit phone width */
            }

            .ticks {
                left: 130px; /* Adjust tick position for mobile */
            }

            .question-item {
                font-size: 1rem;
                padding: 12px;
            }
            
            .number-badge {
                min-width: 30px;
                height: 30px;
                margin-right: 10px;
            }
        }
    </style>
</head>
<body>

    <h1>Degrees Spiritual</h1>

    <div class="container">
        <div class="thermometer-wrapper">
            <div class="thermo-3d" id="thermo-3d" aria-hidden="true"></div>
            <div class="thermo-2d">
                <div class="thermometer-glass">
                    <div class="mercury" id="mercury"></div>
                </div>
                <div class="thermometer-bulb"></div>
            </div>
            
            <div class="ticks">
                <div class="tick-mark"><div class="tick-line"></div> 6</div>
                <div class="tick-mark"><div class="tick-line"></div> 5</div>
                <div class="tick-mark"><div class="tick-line"></div> 4</div>
                <div class="tick-mark"><div class="tick-line"></div> 3</div>
                <div class="tick-mark"><div class="tick-line"></div> 2</div>
                <div class="tick-mark"><div class="tick-line"></div> 1</div>
            </div>
        </div>

        <div class="questions-list">
            <div class="question-item" onclick="setLevel(6)">
                <div class="number-badge">6</div>
                <div>Certain you belong to the Lord forever?</div>
            </div>
            <div class="question-item" onclick="setLevel(5)">
                <div class="number-badge">5</div>
                <div>Have you felt Satan's attacks?</div>
            </div>
            <div class="question-item" onclick="setLevel(4)">
                <div class="number-badge">4</div>
                <div>Do you really pray?</div>
            </div>
            <div class="question-item" onclick="setLevel(3)">
                <div class="number-badge">3</div>
                <div>Do you like to be with other Christians?</div>
            </div>
            <div class="question-item" onclick="setLevel(2)">
                <div class="number-badge">2</div>
                <div>Do you read and love His Word?</div>
            </div>
            <div class="question-item" onclick="setLevel(1)">
                <div class="number-badge">1</div>
                <div>Do you know the Lord personally?</div>
            </div>

            <button class="reset-btn" onclick="setLevel(0)">Reset (Joash Failure)</button>
        </div>
    </div>

    <script>
        let currentLevel = 6;
        let setMercuryLevel3D = null;

        function setLevel(level) {
            currentLevel = level;

            // 1. Update Mercury Height (2D fallback)
            const mercury = document.getElementById('mercury');
            
            // Calculation: 
            // Level 0 = 5% (Just visible in bulb)
            // Level 6 = 95% (Top)
            // The step is roughly 15% per level
            let heightPercentage = 5; 
            if (level > 0) {
                heightPercentage = (level * 15) + 5; 
            }
            if (mercury) {
                mercury.style.height = heightPercentage + "%";
            }

            // 2. Update Active States
            // We get all items and reverse them so Index 0 = Question 1
            const items = Array.from(document.querySelectorAll('.question-item')).reverse();
            
            // Reset all first
            items.forEach(item => item.classList.remove('active'));

            // Highlight everything up to the selected level (showing "Growth")
            // OR if you want to highlight only the current step, change logic here.
            // Current logic: Highlights all steps achieved so far.
            for (let i = 0; i < level; i++) {
                if(items[i]) items[i].classList.add('active');
            }

            if (typeof setMercuryLevel3D === 'function') {
                setMercuryLevel3D(level);
            }
        }

        function initThreeThermometer() {
            const container = document.getElementById('thermo-3d');
            if (!container || !window.WebGLRenderingContext) {
                return;
            }

            import('https://unpkg.com/three@0.152.2/build/three.module.js')
                .then((THREE) => {
                    if (!container.isConnected) {
                        return;
                    }

                    document.body.classList.add('is-3d');

                    const scene = new THREE.Scene();
                    const camera = new THREE.PerspectiveCamera(35, 1, 0.1, 100);
                    camera.position.set(0, 1.2, 6);

                    const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
                    renderer.setPixelRatio(window.devicePixelRatio || 1);
                    renderer.setClearColor(0x000000, 0);
                    if ('outputColorSpace' in renderer) {
                        renderer.outputColorSpace = THREE.SRGBColorSpace;
                    } else if ('outputEncoding' in renderer) {
                        renderer.outputEncoding = THREE.sRGBEncoding;
                    }
                    container.appendChild(renderer.domElement);

                    const ambient = new THREE.AmbientLight(0xffffff, 0.7);
                    scene.add(ambient);

                    const keyLight = new THREE.DirectionalLight(0xffffff, 0.9);
                    keyLight.position.set(4, 6, 4);
                    scene.add(keyLight);

                    const warmGlow = new THREE.PointLight(0xff5a5a, 0.8, 10);
                    warmGlow.position.set(0, -1.2, 2);
                    scene.add(warmGlow);

                    const glassMat = new THREE.MeshPhysicalMaterial({
                        color: 0xffffff,
                        transparent: true,
                        opacity: 0.35,
                        roughness: 0.15,
                        metalness: 0,
                        transmission: 0.9,
                        thickness: 0.6,
                        ior: 1.5,
                        clearcoat: 1,
                        clearcoatRoughness: 0.1
                    });

                    const mercuryMat = new THREE.MeshStandardMaterial({
                        color: 0xc20000,
                        roughness: 0.25,
                        metalness: 0.1,
                        emissive: 0x9a0000,
                        emissiveIntensity: 0.4
                    });

                    const tubeHeight = 4.6;
                    const tubeRadius = 0.5;
                    const tubeCenterY = 1.4;
                    const tubeBottomY = tubeCenterY - tubeHeight / 2;

                    const glass = new THREE.Mesh(
                        new THREE.CylinderGeometry(tubeRadius, tubeRadius, tubeHeight, 48),
                        glassMat
                    );
                    glass.position.y = tubeCenterY;
                    scene.add(glass);

                    const mercuryMesh = new THREE.Mesh(
                        new THREE.CylinderGeometry(tubeRadius * 0.62, tubeRadius * 0.62, tubeHeight, 32),
                        mercuryMat
                    );
                    mercuryMesh.position.y = tubeBottomY;
                    scene.add(mercuryMesh);

                    const bulbRadius = 0.85;
                    const bulbCenterY = tubeBottomY - bulbRadius * 0.4;

                    const bulbGlass = new THREE.Mesh(
                        new THREE.SphereGeometry(bulbRadius, 48, 32),
                        glassMat
                    );
                    bulbGlass.position.y = bulbCenterY;
                    scene.add(bulbGlass);

                    const bulbMercury = new THREE.Mesh(
                        new THREE.SphereGeometry(bulbRadius * 0.78, 48, 32),
                        mercuryMat
                    );
                    bulbMercury.position.y = bulbCenterY;
                    scene.add(bulbMercury);

                    const rim = new THREE.Mesh(
                        new THREE.TorusGeometry(tubeRadius + 0.08, 0.06, 16, 60),
                        new THREE.MeshStandardMaterial({ color: 0x303030, roughness: 0.5, metalness: 0.8 })
                    );
                    rim.rotation.x = Math.PI / 2;
                    rim.position.y = tubeCenterY + tubeHeight / 2;
                    scene.add(rim);

                    const base = new THREE.Mesh(
                        new THREE.CylinderGeometry(1.1, 1.3, 0.35, 32),
                        new THREE.MeshStandardMaterial({ color: 0x444444, roughness: 0.6, metalness: 0.3 })
                    );
                    base.position.y = bulbCenterY - bulbRadius * 1.1;
                    scene.add(base);

                    setMercuryLevel3D = (level) => {
                        const basePct = 0.05;
                        const stepPct = 0.15;
                        const pct = level > 0 ? Math.min(0.95, basePct + level * stepPct) : basePct;
                        const fillHeight = tubeHeight * pct;
                        const scaleY = Math.max(0.02, fillHeight / tubeHeight);
                        mercuryMesh.scale.set(1, scaleY, 1);
                        mercuryMesh.position.y = tubeBottomY + fillHeight / 2;

                        const glowIntensity = 0.3 + pct * 0.9;
                        mercuryMat.emissiveIntensity = glowIntensity;
                        warmGlow.intensity = 0.5 + pct * 1.2;
                    };

                    const resize = () => {
                        const width = container.clientWidth;
                        const height = container.clientHeight;
                        if (!width || !height) {
                            return;
                        }
                        renderer.setSize(width, height, false);
                        camera.aspect = width / height;
                        camera.updateProjectionMatrix();
                    };

                    resize();
                    window.addEventListener('resize', resize);

                    const clock = new THREE.Clock();
                    const animate = () => {
                        const t = clock.getElapsedTime();
                        const sway = Math.sin(t * 0.6) * 0.06;
                        glass.rotation.y = sway;
                        mercuryMesh.rotation.y = sway;
                        bulbGlass.rotation.y = sway;
                        bulbMercury.rotation.y = sway;
                        rim.rotation.y = sway;
                        base.rotation.y = sway * 0.4;

                        renderer.render(scene, camera);
                        requestAnimationFrame(animate);
                    };

                    animate();
                    setMercuryLevel3D(currentLevel);
                })
                .catch(() => {
                    // Keep 2D fallback if Three.js fails.
                });
        }

        // --- ON LOAD: Start Full ---
        window.addEventListener('load', () => {
            setLevel(currentLevel);
            initThreeThermometer();
        });
    </script>

</body>
</html>
